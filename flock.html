<!DOCTYPE HTML>
<html>
<head>
<script type="text/javascript" src="victor.js"></script>
<script type="text/javascript">

function animate(){
  canvas = document.getElementById('mycanvas');
  ctx = canvas.getContext('2d');
  ctx.canvas.width = window.innerWidth;
  ctx.canvas.height = window.innerHeight;
  radius = 2;
  boids = [];
  number = 100;
  
  separationDist = 60;
  alignmentDist = 100;
  cohesionDist = 100;

  coherenceScale = 0.005;
  separationScale = 0.0001;
  alignmentScale = 0.1;

  for(i = 0; i < number; i++){
    var velocity = new Victor(Math.random() * 2 - 1, Math.random() * 2 - 1);
    var pos = new Victor(Math.random() * ctx.canvas.width, Math.random() * ctx.canvas.height);
    var b = new Boid(pos, radius, velocity);
    boids[i] = b;
}
  setInterval(drawShape, 10);
}

function drawShape(){
  // Get the canvas element using the DOM
  
  // Make sure we don't execute when canvas isn't supported
  if (canvas.getContext){
    ctx = canvas.getContext('2d');
    ctx.canvas.width = window.innerWidth;
    ctx.canvas.height = window.innerHeight;
  
    // use getContext to use the canvas for drawing
    
    for(i = 0; i < number; i++){
      var b = boids[i];
      b.acc = new Victor(0, 0);

      if (b.pos.x > ctx.canvas.width){
        b.pos.x = b.pos.x % ctx.canvas.width;
      } else if (b.pos.x < 0){
        b.pos.x = ctx.canvas.width + b.pos.x;
      }
      if (b.pos.y > ctx.canvas.height){
        b.pos.y = b.pos.y % ctx.canvas.height;
      } else if (b.pos.y < 0){
        b.pos.y = ctx.canvas.height + b.pos.y;
      }
      var av = new Victor(0, 0);
      var ave = new Victor(0, 0);
      var count = 0
      for(j = 0; j < number; j++){
        var B = boids[j];
        //Separation
        var dis = b.pos.distance(B.pos);
        
         if(dis < separationDist & b != B){
            //console.log("getting a bit close there chirpy..." +  " " + b.velocity);
            var p = new Victor(b.pos.x, b.pos.y);
            p.subtract(B.pos);
            var sc = separationScale * (separationDist - dis/separationDist);
            var scv = new Victor(sc, sc);
            p.multiply(scv);
            //console.log(p);
            av.add(p);
          } 

        //Cohesion

        if(dis < alignmentDist & b != B){
          ave.add(B.pos);
          count++;
        }

        //Alignment


      }
      //Separation
      b.acc.add(av);


      //Cohesion
      ave.divide(count);
      pc = new Victor(ave.x, ave.y);
      pc.subtract(b.pos);
      pc.normalize();
      var cs = new Victor(coherenceScale, coherenceScale);
      pc.multiply(cs);
      b.acc.add(pc);
      //console.log(b.velocity);

      //Movement
      b.velocity.add(b.acc);
      b.velocity.limit(2, 0.8);
      b.pos.add(b.velocity);
      // Draw shapes
      ctx.beginPath();
      ctx.arc(b.pos.x, b.pos.y, b.radius, 0, 2 * Math.PI, false);
      ctx.fillStyle = b.col;
      ctx.fill();
    }

  } else {
    alert('You need Safari or Firefox 1.5+ to see this demo.');
  }
}

function Boid(pos, radius, velocity){
  this.pos = pos;
  this.radius = radius;
  this.velocity = velocity;
  this.acc = new Victor();
  this.col = 'green';
}


</script>
</head>
<body onload="animate();">
   <canvas id="mycanvas"></canvas>
</body>
</html>